---
title: "2: Data Wrangling"
date: "`r Sys.Date()`"
execute: 
  eval: false
---


## Your Turn: Final Case Study

**Task**: Complete the clustering analysis for expense reimbursement data.

```{r}
#| eval: false

# Step 1: Prepare the data for clustering
expense_clustering_data <- expense_data |>
  select(_______, _______, _______, _______) |>     # Fill in: log_amount, weekend_submission, missing_receipt, category_risk
  mutate(
    log_amount_scaled = _______(_______)[,1],       # Fill in: scale, log_amount
    category_risk_scaled = _______(_______)[,1],    # Fill in: scale, category_risk
    weekend_scaled = _______,                       # Fill in: weekend_submission
    receipt_scaled = _______                        # Fill in: missing_receipt
  ) |>
  select(_______, _______, _______, _______)        # Fill in: log_amount_scaled, category_risk_scaled, weekend_scaled, receipt_scaled

# Step 2: Perform k-means clustering
expense_kmeans <- _______(_______= _______) |>      # Fill in: k_means, num_clusters, 3
  set_engine("_______") |>                          # Fill in: stats
  fit(~ ., data = _______)                          # Fill in: expense_clustering_data

# Step 3: Add cluster assignments
expense_results <- expense_data |>
  _______(_______(_______)) |>                      # Fill in: bind_cols, extract_cluster_assignment, expense_kmeans
  mutate(
    cluster = factor(_______, 
                    labels = c("_______", "_______", "_______"))  # Fill in: .cluster, Low Risk, Medium Risk, High Risk
  )

# Step 4: Analyze cluster characteristics
expense_summary <- expense_results |>
  _______(_______) |>                               # Fill in: group_by, cluster
  summarise(
    expenses = _______(),                           # Fill in: n
    avg_amount = _______(_______),                  # Fill in: mean, amount
    max_amount = _______(_______),                  # Fill in: max, amount
    weekend_pct = _______(_______) * 100,           # Fill in: mean, weekend_submission
    missing_receipt_pct = _______(_______) * 100,   # Fill in: mean, missing_receipt
    avg_category_risk = _______(_______),           # Fill in: mean, category_risk
    .groups = "_______"                             # Fill in: drop
  )

print(_______)                                      # Fill in: expense_summary

# Step 5: Identify employees in high-risk cluster
high_risk_employees <- expense_results |>
  filter(_______ == "_______") |>                   # Fill in: cluster, High Risk
  _______(_______) |>                               # Fill in: count, employee_id
  arrange(desc(_______))                            # Fill in: n

print("Employees with high-risk expenses:")
print(_______)                                      # Fill in: high_risk_employees
```

**Fill in the blanks (25 total)**:
1-4. Variables to select: `_____, _____, _____, _____`
5-6. Scaling function and variable: `_____, _____`
7-8. Scaling function and variable: `_____, _____`
9. Weekend variable: `_____`
10. Receipt variable: `_____`
11-14. Scaled variables to select: `_____, _____, _____, _____`
15-17. K-means setup: `_____, _____, _____`
18. Engine: `_____`
19. Data: `_____`
20-22. Bind cluster assignments: `_____, _____, _____`
23-25. Cluster labels: `_____, _____, _____, _____`

## Assignment: Clustering Blog Post

**For your course blog, complete the following assignment:**

### Part 1: Clustering Analysis (60 points)
Using the expense reimbursement data from the final case study:
1. Implement k-means clustering with appropriate data preparation
2. Determine optimal number of clusters using the elbow method
3. Analyze and interpret cluster characteristics
4. Create visualizations showing cluster results

### Part 2: Audit Memo (40 points)
Write a professional audit memo that includes:
1. Executive summary of findings
2. Methodology explanation (non-technical)
3. Specific control recommendations
4. Implementation timeline and responsibilities
